---
import { SITE_METADATA } from "../config/site";

export interface Props {
  title?: string;
  description?: string;
  author?: string;
  canonicalPath?: string;
  url?: string | URL;
  image?: string | URL;
  noindex?: boolean;
  type?: "website" | "article";
  pubDate?: Date;
  structuredData?: Record<string, unknown> | Record<string, unknown>[];
}

import "@fontsource-variable/space-grotesk";
import "@fontsource/ibm-plex-mono";
import Seo from "../components/Seo.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import "../styles/global.css";

const {
  title = SITE_METADATA.title,
  description = SITE_METADATA.description,
  author = SITE_METADATA.author.name,
  canonicalPath,
  url,
  image,
  noindex = false,
  type = "website",
  pubDate,
  structuredData,
} = Astro.props;

const siteOrigin =
  Astro.site instanceof URL
    ? Astro.site
    : Astro.site
      ? new URL(Astro.site)
      : new URL(SITE_METADATA.siteUrl);

const canonicalValue = canonicalPath ?? url ?? Astro.url.pathname;
const canonicalURL = new URL(canonicalValue ?? "/", siteOrigin);

const structuredDataEntries = Array.isArray(structuredData)
  ? structuredData
  : structuredData
    ? [structuredData]
    : [];

const webSiteJsonLd = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: SITE_METADATA.title,
  url: siteOrigin.href,
  description: SITE_METADATA.description,
  inLanguage: SITE_METADATA.language,
  publisher: {
    "@type": "Person",
    name: SITE_METADATA.author.name,
    url: SITE_METADATA.author.url,
  },
};

const jsonLdPayloads = [webSiteJsonLd, ...structuredDataEntries];
---

<!doctype html>
<html lang={SITE_METADATA.language} dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="shaare.it" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="generator" content={Astro.generator} />
    <meta name="color-scheme" content="dark light" />
    <meta
      name="theme-color"
      media="(prefers-color-scheme: light)"
      content="#f5f5f5"
    />
    <meta
      name="theme-color"
      media="(prefers-color-scheme: dark)"
      content="#18181b"
    />
    <Seo
      {title}
      {description}
      {author}
      canonicalURL={canonicalURL}
      image={image}
      {noindex}
      {type}
      {pubDate}
    />
    {
      jsonLdPayloads.map((schema) => (
        <script
          type="application/ld+json"
          is:inline
          set:html={JSON.stringify(schema)}
        />
      ))
    }
    <script is:inline>
      const saved = localStorage.getItem("theme");
      const prefersDark = window.matchMedia(
        "(prefers-color-scheme: dark)"
      ).matches;
      document.documentElement.classList.add(
        saved || (prefersDark ? "dark" : "light")
      );
    </script>
    {
  import.meta.env.PROD && (
    <>
    <script
      is:inline
      src="https://www.googletagmanager.com/gtag/js?id=G-SJ47MWE6C1"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-SJ47MWE6C1");
    </script>
        </>
  )
}
  </head>
  <body class="body-margin">
    <a class="skip-link" href="#main-content">Skip to main content</a>
    <Header />
    <main
      id="main-content"
      class="main-margin bg-background relative z-1 min-h-svh"
      tabindex="-1"
    >
      <slot />
    </main>
    <Footer />
  </body>
</html>
